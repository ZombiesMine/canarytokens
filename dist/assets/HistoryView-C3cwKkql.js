import{y as U,a as o,c as l,A as ne,d as L,z as M,f as t,i as d,O as ae,I as h,P as S,E as f,h as j,Q as Z,w as le,r as y,o as Y,C as ie,R as q,D as A,e as w,b,j as I,g as R,K as ee,u as g,n as G,V as H,T as V,W as re,X as J,t as K,Y as O,Z as ce,$ as ue,B as te,a0 as z,a1 as de,q as _e,k as pe,a2 as fe,a3 as me,a4 as he,p as ge,l as ye}from"./index-CgX7G-bS.js";import{B as X}from"./BannerDeviceCanarytools-CvhW3CcB.js";const ve={},xe={class:"grid two-col-grid"};function we(e,s){return o(),l("div",xe,[ne(e.$slots,"default")])}const be=U(ve,[["render",we]]),ke={class:"w-full @container"},Te={class:"flex flex-row items-center flex-1 gap-16"},$e={class:"text-left"},Ce={class:"capitalize text-grey-400"},Ie={class:"mr-8 font-semibold"},Le={class:"flex flex-row items-center justify-end gap-8 mt-8 font-semibold text-red sm:hidden"},Se=L({__name:"CardIncident",props:{lastKey:{type:Boolean},incidentPreviewInfo:{},incidentId:{}},emits:["click"],setup(e,{emit:s}){const n=s;function i(){n("click")}return(r,p)=>{const _=M("font-awesome-icon");return o(),l("li",ke,[t("button",Z(r.$attrs,{class:["relative w-full px-16 py-8 transition duration-100 bg-white border text-grey-700 grouped group rounded-2xl shadow-solid-shadow-grey border-grey-200 error-card",{"mb-8":r.lastKey}],onClick:le(i,["stop"])}),[t("span",Te,[d(ae,{class:"hidden @xs:block min-w-[30px] group-hover:fill-red group-focus:fill-red group-active:fill-red fill-grey-700 group-hover:scale-95 transition duration-200","aria-hidden":"true"}),t("span",$e,[(o(!0),l(h,null,S(r.incidentPreviewInfo,(c,m)=>(o(),l("span",{key:m,class:"block"},[t("span",Ce,f(m)+": ",1),t("span",Ie,f(c),1)]))),128))])]),t("span",Le,[j("Check Incident "),d(_,{icon:"arrow-right",class:"text-red","aria-hidden":"true"})])],16)])}}}),De=U(Se,[["__scopeId","data-v-8d14ca6b"]]),Be={key:0},Me={key:1,class:"placeholder-map"},Ee={class:"font-medium"},Ne={class:"pb-8"},Oe={class:"font-medium"},Pe={class:"pt-8"},je=L({__name:"CustomMap",props:{hitsList:{}},setup(e){const s=e,n=y(!0),i=y(),r=y(),p=y({lat:0,lng:0});function _(a){const u=a.split(",");return{lat:parseFloat(u[0]),lng:parseFloat(u[1])}}Y(()=>{if(s.hitsList.length!==0){if(s.hitsList.length>1)return D();s.hitsList.length===1&&(p.value=_(s.hitsList[0].geo_info.loc))}});const c=ie(()=>s.hitsList.map(a=>({id:a.time_of_hit,ip:a.geo_info.ip,hostname:a.geo_info.hostname,city:a.geo_info.city,country:a.geo_info.country,date:q(a.time_of_hit),position:a.geo_info.loc?_(a.geo_info.loc):void 0})));function m(a){i.value=a}async function D(){const a=await r.value.$mapPromise,u=new window.google.maps.LatLngBounds;c.value.forEach(x=>{u.extend(x.position)}),a.fitBounds(u)}A(r,()=>{r.value&&r.value.$mapPromise.then(()=>{n.value=!1})});const k=({count:a,position:u})=>new window.google.maps.Marker({label:{text:`${a}`,color:"white",fontWeight:"600"},icon:{url:R("icons/map-cluster-pin.png"),scaledSize:{width:40,height:40}},position:u,zIndex:1e3+a}),T={zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1,styles:[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{lightness:"52"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{lightness:"60"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{lightness:"24"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{lightness:"29"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{lightness:"47"},{hue:"#ff0000"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:13.400000000000006},{lightness:57.599999999999994},{gamma:1}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]},{featureType:"road.highway",elementType:"all",stylers:[{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",elementType:"all",stylers:[{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",elementType:"all",stylers:[{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"water",elementType:"geometry.fill",stylers:[{lightness:"38"},{saturation:"-55"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:"65"},{saturation:"52"}]}]};return(a,u)=>{const x=ee,v=M("GMapInfoWindow"),C=M("GMapMarker"),E=M("GMapCluster"),se=M("GMapMap");return o(),l(h,null,[n.value?(o(),l("div",Be,[d(x,{type:"rectangle",class:"md:h-[40svh] h-[30svh]"})])):w("",!0),!n.value&&a.hitsList.length===0?(o(),l("div",Me)):(o(),b(se,Z({key:2},a.$attrs,{ref_key:"mapRef",ref:r,zoom:6,center:p.value,"map-type-id":"terrain",class:"grid-areas rounded-2xl",options:T}),{default:I(()=>[d(E,{renderer:{render:k},"zoom-on-click":!0},{default:I(()=>[(o(!0),l(h,null,S(c.value,($,oe)=>(o(),b(C,{key:oe,position:$.position,clickable:!0,icon:{url:g(R)("icons/map-pin.png"),scaledSize:{width:60,height:60},labelOrigin:{x:16,y:-60}},onClick:N=>m($.id)},{default:I(()=>[d(v,{closeclick:!0,opened:i.value===$.id,class:"px-8 py-8",onCloseclick:u[0]||(u[0]=N=>m(null))},{default:I(()=>{var N,F;return[t("ul",null,[t("li",null,[j(" From IP: "),t("span",Ee,f($.ip),1)]),t("li",Ne,f($.hostname),1),t("li",Oe,f($.date),1),t("li",Pe,f($.city)+", "+f($.country),1),t("li",null," Lat: "+f(((N=$.position)==null?void 0:N.lat)||"")+", Lng: "+f(((F=$.position)==null?void 0:F.lng)||""),1)])]}),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["renderer"])]),_:1},16,["center"]))],64)}}}),Ve={class:"block text-xs uppercase text-grey-500"},P=L({__name:"IncidentDetailsListItem",props:{label:{},value:{type:[String,Boolean,Number]}},setup(e){function s(n){if(typeof n=="boolean")return n?"text-green":"text-red"}return(n,i)=>(o(),l("li",null,[t("span",Ve,f(n.label),1),t("span",{class:G(s(n.value))},f(n.value),3)]))}}),ze={class:"p-16 text-white rounded-md bg-red"},Re=t("h2",{class:"font-semibold"},"Incident info",-1),Ge={class:"flex flex-col justify-between gap-24 mt-16 md:flex-row"},Ke={class:"flex flex-col gap-2"},We=t("span",{class:"text-xs text-red-100"},"Date",-1),Ue={class:"font-semibold"},Ye={class:"flex flex-col gap-2"},qe=t("span",{class:"text-xs text-red-100"},"IP",-1),Fe={class:"font-semibold"},He={class:"flex flex-col gap-2"},Je=t("span",{class:"text-xs text-red-100"},"Channel",-1),Xe={class:"font-semibold"},Qe=L({__name:"IncidentDetailsSummary",props:{date:{},ip:{},inputChannel:{}},setup(e){return(s,n)=>(o(),l("section",ze,[Re,t("ul",Ge,[t("li",Ke,[We,t("span",Ue,f(s.date)+"Â ",1)]),t("li",Ye,[qe,t("span",Fe,f(s.ip),1)]),t("li",He,[Je,t("span",Xe,f(s.inputChannel),1)])])]))}});function Ze(e,s){return J.hasOwnProperty(s)?J[s]:e}function Ae(e){return e.replace(/_/g," ").replace(/^(.)/,function(n,i){return i.toUpperCase()})}function W(e){try{return Object.entries(e).reduce((s,[n,i])=>{const r=H.hasOwnProperty(n)?H[n]:Ae(n);return typeof i=="object"&&i!==null?s[r]=W(i):s[r]=i,s},{})}catch(s){return console.error(`Error in formatting labels: ${s}`),e}}function et(e){const s=Object.values(V).find(n=>n===e);return s?K[s].label:e}function B(e){return typeof e=="object"&&e!==null?Array.isArray(e)?e.length>0:Object.values(e).some(s=>s!=null&&(typeof s!="object"||Object.keys(s).length>0)):e!=null}function tt(e){return e===V.CREDIT_CARD}function st(e){return e===V.AWS_KEYS}function Q(e){var s,n;try{return{basic_info:{token_type:et(e.token_type),input_channel:Ze(e.input_channel,e.token_type),src_data:e.src_data,useragent:e.useragent||null,last4:e.last4||null,amount:e.amount||null,merchant:e.merchant||null,mail:e.mail||null,referer:e.referer||null,location:(e.token_type===V.PWA?typeof e.location=="string"?e.location:(s=e.location)==null?void 0:s.coords:e.location)||null,request_args:e.request_args||null},time_of_hit:q(e.time_of_hit),src_ip:e.src_ip,geo_info:e.geo_info.bogon?{ip:e.geo_info.ip,bogon:e.geo_info.bogon}:{...e.geo_info},is_tor_relay:tt(e.token_type)?null:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:st(e.token_type)&&e.additional_info.aws_key_log_data?{last_used:e.additional_info.aws_key_log_data.last_used?re(e.additional_info.aws_key_log_data.last_used):null,service_used:e.additional_info.aws_key_log_data.service_used,eventName:((n=e.additional_info.aws_key_log_data)==null?void 0:n.eventName)??null}:null}}}catch(i){return console.error(`Error in building the Incident Details object: ${i}`),e}}const ot=e=>(ce("data-v-fa1dc03c"),e=e(),ue(),e),nt={class:"pb-32 bg-white sm:m-8 rounded-3xl"},at={class:"sticky top-[0px] bg-white h-[4rem] sm:h-40 flex justify-end"},lt={class:"px-16"},it={class:"grid md:grid-cols-[auto_1fr] gap-32 mt-32 pl-8"},rt={key:0,class:"text-grey-500"},ct={key:1,class:"flex flex-col gap-16 pb-16 [&:not(:last-child)]:border-b md:ml-32 border-grey-100"},ut={key:0,class:"break-words"},dt={class:"text-grey-500"},_t=ot(()=>t("div",{class:"border-b border-grey-100"},null,-1)),pt=L({__name:"IncidentDetails",props:{hitAlert:{}},emits:["close"],setup(e,{emit:s}){const n=e,i=s,r=y(null),p=y({});return Y(()=>{r.value=Q(n.hitAlert),p.value=W(r.value)}),A(()=>n.hitAlert,()=>{r.value=Q(n.hitAlert),p.value=W(r.value)}),(_,c)=>{var D;const m=M("font-awesome-icon");return o(),l("div",nt,[t("div",at,[t("button",{type:"button",class:"px-16",onClick:c[0]||(c[0]=k=>i("close"))},[d(m,{icon:"xmark",class:"w-24 h-24 sm:w-16 sm:h-16 text-grey-400 hover:text-grey-200"})])]),t("div",lt,[r.value?(o(),b(Qe,{key:0,date:(D=r.value)==null?void 0:D.time_of_hit,ip:r.value.src_ip,"input-channel":r.value.basic_info.input_channel},null,8,["date","ip","input-channel"])):w("",!0),t("section",it,[(o(!0),l(h,null,S(p.value,(k,T)=>(o(),l(h,{key:T},[g(B)(T)&&g(B)(k)?(o(),l("h3",rt,f(T)+": ",1)):w("",!0),g(B)(k)?(o(),l("ul",ct,[g(O)(k)?(o(!0),l(h,{key:1},S(k,(a,u)=>(o(),l(h,{key:u},[g(B)(a)?(o(),l("ul",ut,[g(O)(a)?(o(),l(h,{key:1},[t("ul",null,[t("h3",dt,f(u)+":",1),(o(!0),l(h,null,S(a,(x,v)=>(o(),l(h,{key:v},[!g(O)(x)&&g(B)(x)?(o(),b(P,{key:0,label:v,value:x,class:"py-8 ml-24"},null,8,["label","value"])):(o(!0),l(h,{key:1},S(x,(C,E)=>(o(),l(h,{key:E},[!g(O)(C)&&g(B)(C)?(o(),b(P,{key:0,label:v,value:C,class:"py-8 ml-24"},null,8,["label","value"])):w("",!0)],64))),128))],64))),128))]),_t],64)):(o(),b(P,{key:0,label:u,value:a},null,8,["label","value"]))])):w("",!0)],64))),128)):(o(),b(P,{key:0,value:k},null,8,["value"]))])):w("",!0)],64))),128))])])])}}}),ft=U(pt,[["__scopeId","data-v-fa1dc03c"]]),mt={class:"flex flex-row flex-wrap items-center justify-between px-16 py-8 mb-8 bg-white border rounded-2xl shadow-solid-shadow-grey border-grey-100"},ht=t("p",{class:"text-sm text-grey-500"},"Download list",-1),gt={class:"flex flex-row"},yt=L({__name:"AlertsListDownload",setup(e){const s=te(),n=y(!1),i=y(!1);function r(p){p===z.CSV?n.value=!0:i.value=!0;const _={fmt:p,auth:s.params.auth,token:s.params.token};de(_).then(c=>{window.location.href=c.request.responseURL}).catch(c=>{console.log(c,"err")}).finally(()=>{n.value=!1,i.value=!1,console.log("You downloaded the file, yay!")})}return(p,_)=>{const c=_e;return o(),l("li",mt,[ht,t("div",gt,[d(c,{variant:"text",icon:"file",loading:n.value,onClick:_[0]||(_[0]=m=>r(g(z).CSV))},{default:I(()=>[j("CSV")]),_:1},8,["loading"]),d(c,{variant:"text",icon:"file-excel",loading:i.value,onClick:_[1]||(_[1]=m=>r(g(z).JSON))},{default:I(()=>[j("JSON")]),_:1},8,["loading"])])])}}}),vt={class:"flex flex-col gap-16 mx-16 mt-[60px]"},xt={class:"flex flex-col gap-16 mt-[60px]"},wt={class:"flex flex-col h-full gap-16 pb-16"},bt=t("h2",{class:"font-semibold leading-5 text-grey-800"},"Alerts list",-1),kt={key:0,class:"flex flex-col items-center justify-center flex-grow px-16 py-16 align-middle"},Tt=t("p",{class:"text-xl text-center text-grey-400"}," There are no alerts for this Canarytoken. ",-1),$t=["src"],Ct=L({__name:"HistoryToken",emits:["update-token-title"],setup(e,{emit:s}){const n=s,i=te(),r=pe(),p=y(!1),_=y(null),c=y(),m=y();Y(async()=>{await D()});async function D(){p.value=!0;const T={auth:i.params.auth,token:i.params.token};try{const u=await(await fe(T)).data;c.value=u.history.hits.sort((x,v)=>v.time_of_hit-x.time_of_hit),n("update-token-title",u.history.token_type,i.params.token)}catch(a){console.log(a,"err!"),_.value=a.toString(),r.push({name:"error"})}finally{p.value=!1}}async function k(T){await he(()=>{m.value=T;const a=document.getElementById("incident_detail");a?a.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})})}return(T,a)=>{const u=ee,x=ge;return o(),l(h,null,[p.value?(o(),l(h,{key:0},[t("div",vt,[d(u,{type:"header",class:"w-[200px]"}),d(u,{class:"h-[10vh]"}),d(u,{class:"h-[10vh]"}),d(u,{class:"h-[10vh]"})]),t("div",xt,[d(u,{class:"h-[50svh] w-full"}),d(u,{class:"h-[20svh] w-full"})])],64)):w("",!0),_.value?(o(),b(x,{key:1,variant:"danger",message:"Oh no! Something went wrong. Please refresh the page or try again later."})):w("",!0),c.value?(o(),l(h,{key:2},[t("div",{id:"alerts-card-list",class:G(["flex-col md:p-16 md:bg-grey-50 md:rounded-3xl md:overflow-scroll md:max-h-[70svh]",{"hidden md:block":m.value}])},[t("ul",wt,[bt,c.value.length===0?(o(),l("li",kt,[Tt,t("img",{src:g(R)("token_icons/default.png"),alt:"No alerts",class:"grayscale opacity-50 w-[50%] not-sr-only group-hover:opacity-100 sm:block mt-16"},null,8,$t)])):(o(),b(yt,{key:1})),(o(!0),l(h,null,S(c.value,(v,C)=>(o(),b(De,{key:C,"last-key":C===c.value.length-1,"incident-id":v.time_of_hit,"incident-preview-info":{Date:g(q)(v.time_of_hit),IP:v.src_ip,Channel:v.input_channel},onClick:E=>k(v)},null,8,["last-key","incident-id","incident-preview-info","onClick"]))),128)),d(X,{class:"flex sm:hidden"})])],2),t("div",null,[t("div",{class:G(["@md:relative md:h-[45svh] h-[30svh]",c.value.length===0?"hidden sm:grid":"grid"])},[d(me,{name:"slide-fade"},{default:I(()=>[m.value?(o(),b(ft,{key:0,id:"incident_detail","hit-alert":m.value,class:"absolute top-[120px] left-[0] md:top-[0px] md:relative grid-areas z-10 md:overflow-scroll w-full sm:w-auto",onClose:a[0]||(a[0]=v=>m.value=null)},null,8,["hit-alert"])):w("",!0)]),_:1}),d(je,{"hits-list":c.value},null,8,["hits-list"])],2),d(X,{class:"hidden sm:flex"})])],64)):w("",!0)],64)}}}),It={key:0,class:"flex flex-col items-center gap-8 mt-16"},Lt={class:"mb-24 text-xl text-center text-grey-500"},St={class:"text-grey-300"},Dt={class:"font-semibold"},Et=L({__name:"HistoryView",setup(e){const s=y(""),n=y(""),i=y("");function r(p,_){s.value=K[p].label,i.value=K[p].icon,n.value=_}return(p,_)=>(o(),l(h,null,[s.value&&n.value&&i.value?(o(),l("div",It,[d(ye,{title:s.value,"logo-img-url":i.value,class:"h-[4rem] w-[4rem]","has-shadow":!1},null,8,["title","logo-img-url"]),t("div",Lt,[t("h2",null,[t("span",St,f(s.value)+" Canarytoken ID: ",1),t("span",Dt,f(n.value),1)])])])):w("",!0),d(be,null,{default:I(()=>[d(Ct,{onUpdateTokenTitle:_[0]||(_[0]=(c,m)=>r(c,m))})]),_:1})],64))}});export{Et as default};
